<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Historias con IA</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
    <!-- Alertas fijas en la parte superior -->
    <div id="alertsContainer"></div>
    
    <div class="container mt-5">
        <div class="text-center mb-5">
            <h1 class="display-4 text-white mb-3">
                <i class="bi bi-book-half me-3"></i>
                Generador de Historias con IA
            </h1>
            <p class="lead text-white-50">
                Crea historias únicas y cautivadoras con la ayuda de inteligencia artificial
            </p>
        </div>

        <!-- Formulario de entrada -->
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="bi bi-pencil-square me-2"></i>
                            Configuración de tu Historia
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <form id="storyForm">
                            <!-- Pestañas para diferentes tipos de entrada -->
                            <ul class="nav nav-tabs mb-4" id="inputTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="structured-tab" data-bs-toggle="tab" data-bs-target="#structured" type="button" role="tab">
                                        <i class="bi bi-list-check me-2"></i>Formulario Estructurado
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="natural-tab" data-bs-toggle="tab" data-bs-target="#natural" type="button" role="tab">
                                        <i class="bi bi-chat-text me-2"></i>Descripción Libre
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="interactive-tab" data-bs-toggle="tab" data-bs-target="#interactive" type="button" role="tab">
                                        <i class="bi bi-joystick me-2"></i>Historia Interactiva
                                    </button>
                                </li>
                            </ul>

                            <div class="tab-content" id="inputTabsContent">
                                <!-- Formulario Estructurado -->
                                <div class="tab-pane fade show active" id="structured" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="genero" class="form-label">
                                                <i class="bi bi-tag me-2"></i>Género
                                            </label>
                                            <select class="form-select" id="genero" name="genero">
                                                <option value="">Selecciona un género</option>
                                                <option value="fantasía">Fantasía</option>
                                                <option value="misterio">Misterio</option>
                                                <option value="romance">Romance</option>
                                                <option value="terror">Terror</option>
                                                <option value="ciencia ficción">Ciencia Ficción</option>
                                                <option value="comedia">Comedia</option>
                                                <option value="aventura">Aventura</option>
                                                <option value="drama">Drama</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="tono" class="form-label">
                                                <i class="bi bi-emoji-smile me-2"></i>Tono
                                            </label>
                                            <select class="form-select" id="tono" name="tono">
                                                <option value="">Selecciona un tono</option>
                                                <option value="humorístico">Humorístico</option>
                                                <option value="oscuro">Oscuro</option>
                                                <option value="caprichoso">Caprichoso</option>
                                                <option value="dramático">Dramático</option>
                                                <option value="satírico">Satírico</option>
                                                <option value="serio">Serio</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="publico_objetivo" class="form-label">
                                                <i class="bi bi-people me-2"></i>Público Objetivo
                                            </label>
                                            <select class="form-select" id="publico_objetivo" name="publico_objetivo">
                                                <option value="">Selecciona el público objetivo</option>
                                                <option value="infantil">Infantil</option>
                                                <option value="adolescentes">Adolescentes</option>
                                                <option value="jóvenes">Jóvenes</option>
                                                <option value="adultos">Adultos</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="extension" class="form-label">
                                                <i class="bi bi-rulers me-2"></i>Extensión
                                            </label>
                                            <select class="form-select" id="extension" name="extension">
                                                <option value="">Selecciona la extensión</option>
                                                <option value="corta (300-400 palabras)">Corta (300-400 palabras)</option>
                                                <option value="mediana (400-600 palabras)">Mediana (400-600 palabras)</option>
                                                <option value="larga (600-800 palabras)">Larga (600-800 palabras)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="personajes" class="form-label">
                                            <i class="bi bi-people me-2"></i>Personajes
                                        </label>
                                        <textarea class="form-control" id="personajes" name="personajes" rows="3" 
                                            placeholder="Describe los personajes principales, sus nombres, roles y características de personalidad..."></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label for="escenario" class="form-label">
                                            <i class="bi bi-geo-alt me-2"></i>Escenario
                                        </label>
                                        <textarea class="form-control" id="escenario" name="escenario" rows="3"
                                            placeholder="Describe el lugar, época, atmósfera y ambiente de la historia..."></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label for="conflicto" class="form-label">
                                            <i class="bi bi-exclamation-triangle me-2"></i>Conflicto Principal
                                        </label>
                                        <textarea class="form-control" id="conflicto" name="conflicto" rows="3"
                                            placeholder="Describe el problema central, obstáculos y tipo de resolución..."></textarea>
                                    </div>
                                </div>

                                <!-- Descripción Libre -->
                                <div class="tab-pane fade" id="natural" role="tabpanel">
                                    <div class="mb-3">
                                        <label for="descripcion" class="form-label">
                                            <i class="bi bi-chat-quote me-2"></i>Describe tu Historia
                                        </label>
                                        <textarea class="form-control" id="descripcion" name="descripcion" rows="8"
                                            placeholder="Describe libremente la historia que quieres que genere la IA. Incluye detalles sobre personajes, escenario, género, tono, conflicto, etc. Mínimo 20 caracteres y especifica el publico o audiencia objetivo para darle el enfoque correcto."></textarea>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Incluye palabras clave como: historia, personaje, escenario, conflicto, aventura, drama, etc.
                                        </div>
                                    </div>
                                </div>

                                <!-- Historia Interactiva -->
                                <div class="tab-pane fade" id="interactive" role="tabpanel">
                                    <div class="mb-3">
                                        <label for="historia_interactiva" class="form-label">
                                            <i class="bi bi-joystick me-2"></i>Describe tu Historia Interactiva
                                        </label>
                                        <textarea class="form-control" id="historia_interactiva" name="historia_interactiva" rows="8"
                                            placeholder="Describe la historia interactiva que quieres que genere la IA. La IA creará una historia con puntos de decisión donde tú puedes elegir el rumbo. Incluye detalles sobre personajes, escenario, género, tono, conflicto, etc. Mínimo 20 caracteres y especifica el publico o audiencia objetivo para darle el enfoque correcto."></textarea>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Las historias interactivas incluyen puntos de decisión donde puedes influir en el desarrollo de la narrativa.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="button" class="btn btn-outline-warning me-md-2" id="resetMemoryBtn">
                                    <i class="bi bi-trash me-2"></i>Limpiar Memoria
                                </button>
                                <button type="button" class="btn btn-outline-secondary me-md-2" id="resetBtn">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Limpiar texto
                                </button>
                                <button type="submit" class="btn btn-primary" id="generateBtn">
                                    <i class="bi bi-magic me-2"></i>Generar Historia
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resultado de la historia -->
        <div id="resultContainer" class="mt-5" style="display: none;">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="result-beauty">
                        <div class="icon-circle mb-3">
                            <i class="bi bi-book"></i>
                        </div>
                        <div id="storyTitle" class="score-label mb-2"></div>
                        <div id="storyContent" class="prob-value mb-3"></div>
                        <div id="storyMoraleja" class="card-footer" style="display: none;"></div>
                        <div class="mt-4">
                            <button type="button" class="btn btn-outline-light btn-sm me-2" id="copyBtn">
                                <i class="bi bi-clipboard me-1"></i>Copiar
                            </button>
                            <button type="button" class="btn btn-outline-light btn-sm" id="regenerateBtn">
                                <i class="bi bi-arrow-repeat me-1"></i>Regenerar
                            </button>
                            <!-- Botón para generar imagen -->
                            <button type="button" class="btn btn-outline-success btn-sm ms-2" id="generateImageBtn">
                                <i class="bi bi-image me-1"></i>Generar Imagen
                            </button>
                        </div>
                        <!-- Contenedor para mostrar la imagen generada -->
                        <div id="imageContainer" class="mt-4" style="display:none;">
                            <h6 class="text-white mb-2"><i class="bi bi-image me-2"></i>Ilustración generada</h6>
                            <img id="generatedImage" src="" alt="Imagen generada" class="img-fluid rounded shadow" style="max-width:100%;border:2px solid #fff;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading spinner -->
        <div id="loadingSpinner" class="text-center mt-5" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Generando historia...</span>
            </div>
            <p class="text-white mt-3">Generando tu historia con IA...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>